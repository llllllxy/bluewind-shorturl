<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>短链接生成</title>
    <meta http-equiv="description" content="bluewind-shorturl在线短链生成"/>
    <meta http-equiv="keywords" content="蓝风软件,短链生成,在线短链生成,长链转短链"/>
    <link rel="icon" th:href="@{/images/favicon.ico}">
    <link rel="bookmark" th:href="@{/images/favicon.ico}">
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/element-ui/2.15.7/theme-chalk/index.min.css">
    <style>

    </style>
</head>
<body style="background-color: #D2F5F1">
<div id="app" style="width: 50%;margin-left: 25%;margin-top: 10%;">
    <el-card class="box-card">
        <el-row :gutter="10">
            <el-col :span="16">
                <el-input size="medium" v-model="originalUrl" placeholder="请输入您的链接，如：http://www.thymeleaf.org">
                </el-input>
            </el-col>
            <el-col :span="4">
                <el-select size="medium" v-model="validityPeriod" placeholder="有效期">
                    <el-option label="七天" value="sevenday"></el-option>
                    <el-option label="3个月" value="threemonth"></el-option>
                    <el-option label="半年" value="halfyear"></el-option>
                    <el-option label="永久" value="forever"></el-option>
                </el-select>
            </el-col>

            <el-col :span="3">
                <el-button size="medium" type="primary" @click="generateShortURL()">生成短链接</el-button>
            </el-col>
        </el-row>

    </el-card>
    <el-card class="box-card" style="margin-top:10px" v-show="ifShowResult">
        <el-row :gutter="10" type="flex" align="middle">
            <el-col :span="4">
                <div ref="qrCodeDiv" style="width: 100px; height: 100px;"> </div>
            </el-col>
            <el-col :span="20">
                <el-row type="flex" align="middle">
                    <span>
                        短链接：<a :href="shortUrl" target="_blank">{{shortUrl}}</a>
                    </span>
                    &nbsp;&nbsp;
                    <el-tooltip class="item" effect="light" content="点击复制短链" placement="top-start">
                        <i class="el-icon-document-copy" @click="copy($event)" style="cursor: pointer"></i>
                    </el-tooltip>
                </el-row>
                <el-row type="flex" align="middle" style="margin-top: 10px">
                    <span style="color: #C5C7CE">
                        原始链接：<a :href="originalUrl" target="_blank" style="color: #C5C7CE">{{originalUrl}}</a>
                    </span>
                </el-row>
            </el-col>
        </el-row>
    </el-card>
</div>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/vue/2.6.12/vue.min.js" type="application/javascript"></script>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/element-ui/2.15.7/index.min.js"></script>
<script src="https://lf3-cdn-tos.bytecdntp.com/cdn/axios/0.26.0/axios.min.js"></script>
<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/qs/6.10.3/qs.min.js" type="application/javascript"></script>
<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/clipboard.js/2.0.8/clipboard.min.js" type="application/javascript"></script>
<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/qrcodejs/1.0.0/qrcode.min.js" type="application/javascript"></script>

<script>
    new Vue({
        el: '#app',
        data: function() {
            return {
                message: 'Hello Vue.js!',
                originalUrl: '',
                validityPeriod: '',
                shortUrl: '',
                qrcode: '',
                ifShowResult: false
            }
        },
        methods: {
            copy: function(event) {
                this.handleClipboard(this.shortUrl, event);
            },
            generateShortURL: function() {
                if (this.originalUrl) {
                    if(!this.originalUrl.startsWith("http://") && !this.originalUrl.startsWith("https://")){
                        this.$message.error('请输入正确的网址链接，注意以http://或https://开头');
                        return;
                    }

                    axios({
                        method: 'post',
                        url: "/generate",
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                        },
                        data: Qs.stringify({
                            originalUrl: this.originalUrl,
                            validityPeriod: this.validityPeriod
                        })
                    }).then((res) => {
                        if (res.data.code == 200) {
                            this.shortUrl = res.data.data;
                            this.ifShowResult = true;
                            this.createQrcode(this.shortUrl);
                        } else {
                            this.$message.error(res.data.msg);
                        }
                    }).catch((res) => {
                        console.log(res);
                    })
                } else {
                    this.$message.error('请输入要转换的链接');
                }
            },
            createQrcode(content) {
                if (this.qrCode) {
                    this.qrCode.clear(); // 清除代码
                    this.qrCode.makeCode(content); // 生成另外一个二维码
                } else {
                    this.qrCode = new QRCode(this.$refs.qrCodeDiv, {
                        text: content, //text必须是字符串
                        width: 100,
                        height: 100,
                        colorDark: "#333333", //二维码颜色
                        colorLight: "#ffffff", //二维码背景色
                        correctLevel: QRCode.CorrectLevel.L //容错率，L/M/H
                    });
                }
            },
            handleClipboard(text, event) {
                const clipboard = new ClipboardJS(event.target, {
                    text: () => text
                });
                clipboard.on('success', () => {
                    this.clipboardSuccess(text);
                    clipboard.destroy();
                });
                clipboard.on('error', () => {
                    this.clipboardError();
                    clipboard.destroy();
                });
                clipboard.onClick(event);
            },
            clipboardSuccess(text) {
                this.$message({
                    message: '已复制到粘贴板',
                    type: 'success'
                });
            },
            clipboardError() {
                this.$message.error('Copy error');
            }
        }
    });
</script>
</body>
</html>